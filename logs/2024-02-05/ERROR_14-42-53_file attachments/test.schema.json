{
    "id": "file attachments",
    "sequences": [
        {
            "caption": "Open work order update file attachments",
            "process": "main"
        },
        {
            "caption": "TC1: Test Tooltip label is correct",
            "process": "TC1"
        },
        {
            "caption": "TC2: File Upload, Download and Delete",
            "process": "TC2"
        },
        {
            "caption": "TC3: File Upload Hyperlink and Upload Cancel",
            "process": "TC3"
        },
        {
            "caption": "TC4: Upload Progress Slider",
            "process": "TC4"
        }
    ],
    "main": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "navigate",
                "args": {
                    "url": "https://onkeydev.pragmaproducts.com/contoso/daily/#dashboard/WorkOrder"
                },
                "next_step": "wait_for_dashboard",
                "name": "start"
            },
            "wait_for_dashboard": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "data-loaded",
                    "value": "true"
                },
                "next_step": "dbl_click_first_row",
                "name": "wait_for_dashboard"
            },
            "dbl_click_first_row": {
                "type": "perform",
                "action": "dbl_click",
                "args": {
                    "query": "#dashboard-grid .grid-row:first-child"
                },
                "next_step": "wait_for_edit_screen",
                "name": "dbl_click_first_row"
            },
            "wait_for_edit_screen": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pragma-action-dialog [data-template=WorkOrderUpdate]"
                },
                "next_step": "wait_for_overflow_button",
                "name": "wait_for_edit_screen"
            },
            "wait_for_overflow_button": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#btnOptions",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "click_overflow_button",
                "name": "wait_for_overflow_button"
            },
            "click_overflow_button": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pragma-action-dialog #dropdown #btnOptions"
                },
                "next_step": "click_file_attachments"
            },
            "click_file_attachments": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-pop-over [data-id='fileAttachments']"
                },
                "next_step": "wait_for_file_attachments_grid"
            },
            "wait_for_file_attachments_grid": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid",
                    "attr": "status",
                    "value": "ready"
                }
            }
        }
    },
    "TC1": {
        "steps": {
            "start": {
                "type": "assert",
                "action": "attribute_eq",
                "args": {
                    "query": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #propertiesPanel",
                    "attr": "tooltip",
                    "value": "Properties Panel",
                    "operator": "eq"
                },
                "next_step": "assert_query_builder",
                "name": "start"
            },
            "assert_query_builder": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #queryBuilder",
                        "value": "Query Builder"
                    }
                },
                "next_step": "assert_export"
            },
            "assert_export": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #exportToExcel",
                        "value": "Export to Excel"
                    }
                },
                "next_step": "assert_summary"
            },
            "assert_summary": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #data-summary",
                        "value": "Data Summary"
                    }
                },
                "next_step": "assert_refresh"
            },
            "assert_refresh": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #refresh",
                        "value": "Refresh"
                    }
                },
                "next_step": "assert_prepared"
            },
            "assert_prepared": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #prepared-fetch",
                        "value": "Prepared Query"
                    }
                },
                "next_step": "assert_delete"
            },
            "assert_delete": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #batch-delete",
                        "value": "Delete"
                    }
                },
                "next_step": "assert_expand"
            },
            "assert_expand": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #expand",
                        "value": "Expand"
                    }
                },
                "next_step": "assert_upload_file"
            },
            "assert_upload_file": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #btn-upload-file",
                        "value": "Upload File"
                    }
                },
                "next_step": "assert_download"
            },
            "assert_download": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "system",
                    "process": "tooltip",
                    "parameters": {
                        "hover": "dynamic-crud-toolbar[for='WorkOrderFileAttachmentsGrid'] #btn-down",
                        "value": "Download"
                    }
                }
            }
        }
    },
    "TC2": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid [name=select-all-checkbox]"
                },
                "next_step": "click_delete",
                "name": "start"
            },
            "click_delete": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "dynamic-crud-toolbar[for=WorkOrderFileAttachmentsGrid] #batch-delete"
                },
                "next_step": "click_ok_for_all"
            },
            "click_ok_for_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnMessage_true"
                },
                "next_step": "wait_child_count"
            },
            "wait_child_count": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "count": 0
                },
                "next_step": "sort_grid"
            },
            "sort_grid": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-field='fileFullName'] span"
                },
                "next_step": "wait_for_toast"
            },
            "wait_for_toast": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "pr-toast",
                    "count": 0
                },
                "next_step": "check_hyperlink_is_present"
            },
            "check_hyperlink_is_present": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#uploadFiles[data-action='uploadFiles']"
                },
                "next_step": "run_script"
            },
            "run_script": {
                "type": "system",
                "action": "run_script",
                "args": {
                    "script": "file_attachment.js"
                },
                "next_step": "wait_file_title"
            },
            "wait_file_title": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "#work-order-file-attachment-1 h4",
                    "value": "Logbook 2022"
                },
                "next_step": "wait_file_icon"
            },
            "wait_file_icon": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#work-order-file-attachment-1 .file-icon",
                    "attr": "icon",
                    "value": "word-file"
                },
                "next_step": "assert_file_edit"
            },
            "assert_file_edit": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#work-order-file-attachment-1 h4 + [icon-name=mode]"
                },
                "next_step": "wait_file_size"
            },
            "wait_file_size": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "#work-order-file-attachment-1 .upload-size",
                    "value": "42Kb"
                },
                "next_step": "click_upload"
            },
            "click_upload": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#file-upload-all-button"
                },
                "next_step": "wait_for_success"
            },
            "wait_for_success": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "#work-order-file-attachment-1 .upload-status",
                    "value": "Complete!"
                },
                "next_step": "wait_child_count_one"
            },
            "wait_child_count_one": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "count": 1
                },
                "next_step": "click_grid_row"
            },
            "click_grid_row": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .grid-row:last-child"
                },
                "next_step": "wait_for_row_selection"
            },
            "wait_for_row_selection": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .grid-row:last-child",
                    "attr": "aria-selected",
                    "value": "true"
                },
                "next_step": "delete_row"
            },
            "delete_row": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "dynamic-crud-toolbar[for=WorkOrderFileAttachmentsGrid] #batch-delete"
                },
                "next_step": "click_ok"
            },
            "click_ok": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnMessage_true"
                },
                "next_step": "wait_child_count_zero"
            },
            "wait_child_count_zero": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "count": 0
                },
                "next_step": "close_toast"
            },
            "close_toast": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-toast [icon-name='close']"
                },
                "next_step": "click_close"
            },
            "click_close": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast [icon-name='close']"
                }
            }
        }
    },
    "TC3": {
        "steps": {
            "start": {
                "type": "system",
                "action": "run_script",
                "args": {
                    "script": "file_attachment.js"
                },
                "next_step": "wait_for_file",
                "name": "start"
            },
            "wait_for_file": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "#work-order-file-attachment-1 h4",
                    "value": "Logbook 2022"
                },
                "next_step": "close_file_upload"
            },
            "close_file_upload": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#close-file-upload"
                },
                "next_step": "check_child_count"
            },
            "check_child_count": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "count": 0
                }
            }
        }
    },
    "TC4": {
        "steps": {
            "start": {
                "type": "system",
                "action": "run_script",
                "args": {
                    "script": "file_attachments.js"
                },
                "next_step": "check_child_count",
                "name": "start"
            },
            "check_child_count": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#file-list",
                    "count": 6
                },
                "next_step": "assert_word_icon"
            },
            "assert_word_icon": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='1'] [icon='word-file']"
                },
                "next_step": "assert_jpg"
            },
            "assert_jpg": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='2'] [icon='image-file']"
                },
                "next_step": "assert_png"
            },
            "assert_png": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='3'] [icon='image-file']"
                },
                "next_step": "assert_excel"
            },
            "assert_excel": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='4'] [icon='excel-file']"
                },
                "next_step": "assert_pdf"
            },
            "assert_pdf": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='5'] [icon='pdf-file']"
                },
                "next_step": "assert_text"
            },
            "assert_text": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='6'] [icon='file']"
                },
                "next_step": "edit_pdf_title"
            },
            "edit_pdf_title": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-file-upload [data-id='5'] [icon-name='mode']"
                },
                "next_step": "wait_for_input"
            },
            "wait_for_input": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='5'] #file-title-input"
                },
                "next_step": "add_text"
            },
            "add_text": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "pr-file-upload [data-id='5'] #file-title-input",
                    "value": "test text"
                },
                "next_step": "accept_edit"
            },
            "accept_edit": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-file-upload [data-id='5'] [data-call='acceptTitleEdit']"
                },
                "next_step": "check_text_content"
            },
            "check_text_content": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "pr-file-upload [data-id='5'] h4",
                    "value": "test text"
                },
                "next_step": "wait_for_category"
            },
            "wait_for_category": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='4'] [data-type='category']"
                },
                "next_step": "set_category"
            },
            "set_category": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-file-upload [data-id='4'] [data-type='category']"
                },
                "next_step": "wait_for_popup_list_item"
            },
            "wait_for_popup_list_item": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#category-list li:last-child"
                },
                "next_step": "click_popup_list_item"
            },
            "click_popup_list_item": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#category-list li:last-child"
                },
                "next_step": "wait_for_category_change"
            },
            "wait_for_category_change": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "pr-file-upload [data-id='4'] [data-type='category'] [data-id='click-target']",
                    "value": "Equipment Manuals"
                },
                "next_step": "wait_for_restriction"
            },
            "wait_for_restriction": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='1'] [data-type='restriction']"
                },
                "next_step": "set_restriction"
            },
            "set_restriction": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-file-upload [data-id='1'] [data-type='restriction']"
                },
                "next_step": "wait_for_restriction_popup_list_item"
            },
            "wait_for_restriction_popup_list_item": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#restriction-list li:last-child"
                },
                "next_step": "click_restriction_popup_list_item"
            },
            "click_restriction_popup_list_item": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#restriction-list li:last-child"
                },
                "next_step": "wait_for_restriction_change"
            },
            "wait_for_restriction_change": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='1'] [data-type='restriction'] svg#lock"
                },
                "next_step": "remove_jpg"
            },
            "remove_jpg": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-file-upload [data-id='2'] .remove-icon"
                },
                "next_step": "wait_child_count_minus_one"
            },
            "wait_child_count_minus_one": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "pr-file-upload #file-list",
                    "count": 5
                },
                "next_step": "upload_all"
            },
            "upload_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#file-upload-all-button"
                },
                "next_step": "wait_for_side_menu"
            },
            "wait_for_side_menu": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "pr-side-menu",
                    "attr": "data-expanded",
                    "value": "true"
                },
                "next_step": "wait_for_message_content"
            },
            "wait_for_message_content": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "pragma-messages .message.error .message-body span",
                    "value": "'.txt' is not an allowed file type"
                },
                "next_step": "close_side_menu"
            },
            "close_side_menu": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-side-menu #messages"
                },
                "next_step": "wait_for_retry_button"
            },
            "wait_for_retry_button": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-file-upload [data-id='6'] [data-call='retryUpload']"
                },
                "next_step": "wait_for_error_status"
            },
            "wait_for_error_status": {
                "type": "wait",
                "action": "text_content",
                "args": {
                    "query": "pr-file-upload [data-id='6'] .upload-status",
                    "value": "Error"
                },
                "next_step": "assert_in_progress"
            },
            "assert_in_progress": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-indicators [icon='timelapse'] + output",
                    "value": "0"
                },
                "next_step": "assert_completed"
            },
            "assert_completed": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-indicators [icon='check-circle-true'] + output",
                    "value": "4"
                },
                "next_step": "assert_error"
            },
            "assert_error": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-indicators [icon='error-outline'] + output",
                    "value": "1"
                },
                "next_step": "check_grid_count"
            },
            "check_grid_count": {
                "type": "wait",
                "action": "child_count",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "count": 4
                },
                "next_step": "open_properties_panel"
            },
            "open_properties_panel": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#fileAttachments #propertiesPanel"
                },
                "next_step": "remove_modified_on"
            },
            "remove_modified_on": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pragma-icon-button[data-id='modifiedOn'][icon-name='hide']"
                },
                "next_step": "close_properties_panel"
            },
            "close_properties_panel": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "properties-panel pragma-icon-button.close"
                },
                "next_step": "assert_text_content"
            },
            "assert_text_content": {
                "type": "assert",
                "action": "element_property_eq",
                "args": {
                    "query": "#WorkOrderFileAttachmentsGrid .items-container",
                    "property": "innerText",
                    "value": "test text.pdf\nfalse\n0\nimage png.png\nfalse\n0\nexcel.xlsx\nfalse\n0\nEquipment Manuals\nLogbook 2022.docx\ntrue\n0"
                }
            }
        }
    }
}