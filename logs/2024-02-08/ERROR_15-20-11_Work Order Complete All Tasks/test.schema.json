{
    "id": "Work Order Complete All Tasks",
    "sequences": [
        {
            "caption": "TC1: Test no selection on complete gives toast.",
            "process": "main"
        },
        {
            "caption": "TC2: Test complete on work order that allow all to be completed shows toast.",
            "process": "completed_successfully"
        },
        {
            "caption": "TC3: Test complete on work order with all tasks already completed shows toast.",
            "process": "all_complete"
        },
        {
            "caption": "TC4: Test complete on work order with tasks that cant complete shows dialog.",
            "process": "cant_complete"
        }
    ],
    "main": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "navigate",
                "args": {
                    "url": "https://onkeydev.pragmaproducts.com/demo/daily?AuthenticationProviderName=Development Azure Account/#dashboard/WorkOrder",
                    "refresh": true
                },
                "next_step": "wait_for_dashboard_to_be_ready",
                "name": "start"
            },
            "wait_for_dashboard_to_be_ready": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "open_assist",
                "name": "wait_for_dashboard_to_be_ready"
            },
            "open_assist": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "click_complete_all",
                "name": "open_assist"
            },
            "click_complete_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-CompleteAllTasks"
                },
                "next_step": "wait_for_toast",
                "name": "click_complete_all"
            },
            "wait_for_toast": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-toast-item"
                },
                "next_step": "assert_toast",
                "name": "wait_for_toast"
            },
            "assert_toast": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-toast-item span",
                    "value": "Please select a work order to continue.",
                    "property": "textContent"
                },
                "next_step": "close_last_toast",
                "name": "assert_toast"
            },
            "close_last_toast": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast-item pragma-icon-button"
                },
                "name": "close_last_toast"
            }
        }
    },
    "completed_successfully": {
        "steps": {
            "start": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "filterRecord",
                    "process": "filter_for_record",
                    "parameters": {
                        "fetch_all_records_selector": "[for='dashboard-grid'] #prepared-fetch",
                        "filter_button_selector": "#pb-5 #rd-3 #search-button",
                        "filter_input_selector": "#pb-5 #rd-3 .responsive-dropdown-filter input",
                        "filter_value": "S00338",
                        "internal_filter_btn_selector": ".dashboard pr-responsive-dropdown#rd-3 #filter"
                    }
                },
                "next_step": "click_record",
                "name": "start"
            },
            "click_record": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": ".grid-row"
                },
                "next_step": "open_assist",
                "name": "click_record"
            },
            "open_assist": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "click_complete_all",
                "name": "open_assist"
            },
            "click_complete_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-CompleteAllTasks"
                },
                "next_step": "wait_for_toast",
                "name": "click_complete_all"
            },
            "wait_for_toast": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-toast-item"
                },
                "next_step": "close_initial_toast",
                "name": "wait_for_toast"
            },
            "close_initial_toast": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast-item pragma-icon-button"
                },
                "next_step": "open_record",
                "name": "close_initial_toast"
            },
            "open_record": {
                "type": "perform",
                "action": "dbl_click",
                "args": {
                    "query": ".grid-row"
                },
                "next_step": "wait_for_dialog",
                "name": "open_record"
            },
            "wait_for_dialog": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderUpdate'][status='ready'][data-ready='true']"
                },
                "next_step": "open_overflow",
                "name": "wait_for_dialog"
            },
            "open_overflow": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "dynamic-update #ts-1 #btnOptions"
                },
                "next_step": "click_tasks",
                "name": "open_overflow"
            },
            "click_tasks": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "li[data-id='tasks']"
                },
                "next_step": "open_first_task",
                "name": "click_tasks"
            },
            "open_first_task": {
                "type": "perform",
                "action": "dbl_click",
                "args": {
                    "query": "#WorkOrderTasksGrid .grid-row"
                },
                "next_step": "wait_for_task_dialog",
                "name": "open_first_task"
            },
            "wait_for_task_dialog": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderTaskUpdate'][status='ready'][data-ready='true']"
                },
                "next_step": "open_feedback",
                "name": "wait_for_task_dialog"
            },
            "open_feedback": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#pb-3_Feedback"
                },
                "next_step": "click_completed",
                "name": "open_feedback"
            },
            "click_completed": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#cb-completed"
                },
                "next_step": "click_btn_options",
                "name": "click_completed"
            },
            "click_btn_options": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-template='WorkOrderTaskUpdate'] #btn-1 #btnOptions"
                },
                "next_step": "click_save_close",
                "name": "click_btn_options"
            },
            "click_save_close": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-template='WorkOrderTaskUpdate'] #save-and-close"
                },
                "next_step": "wait_for_work_order",
                "name": "click_save_close"
            },
            "wait_for_work_order": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderUpdate'][status='ready'][data-ready='true']"
                },
                "next_step": "close_toast",
                "name": "wait_for_work_order"
            },
            "close_toast": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast-item pragma-icon-button"
                },
                "next_step": "open_assist_success",
                "name": "close_toast"
            },
            "open_assist_success": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "click_complete_all_success",
                "name": "open_assist_success"
            },
            "click_complete_all_success": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-CompleteAllTasks"
                },
                "next_step": "wait_for_toast_success",
                "name": "click_complete_all_success"
            },
            "wait_for_toast_success": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-toast-item"
                },
                "next_step": "assert_toast_success",
                "name": "wait_for_toast_success"
            },
            "assert_toast_success": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-toast-item span",
                    "value": "All Tasks Completed Successfully",
                    "property": "textContent"
                },
                "next_step": "close_last_toast",
                "name": "assert_toast_success"
            },
            "close_last_toast": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast-item pragma-icon-button"
                },
                "name": "close_last_toast"
            }
        }
    },
    "all_complete": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "click_complete_all",
                "name": "start"
            },
            "click_complete_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-CompleteAllTasks"
                },
                "next_step": "wait_for_toast_success",
                "name": "click_complete_all"
            },
            "wait_for_toast_success": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pr-toast-item"
                },
                "next_step": "assert_toast_success",
                "name": "wait_for_toast_success"
            },
            "assert_toast_success": {
                "type": "assert",
                "action": "text_content_eq",
                "args": {
                    "query": "pr-toast-item span",
                    "value": "No incomplete Tasks found",
                    "property": "textContent"
                },
                "next_step": "close_last_toast",
                "name": "assert_toast_success"
            },
            "close_last_toast": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pr-toast-item pragma-icon-button"
                },
                "name": "close_last_toast"
            }
        }
    },
    "cant_complete": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "navigate",
                "args": {
                    "url": "https://onkeydev.pragmaproducts.com/demo/daily?AuthenticationProviderName=Development Azure Account/#dashboard/WorkOrder"
                },
                "next_step": "wait_for_dashboard_to_be_ready",
                "name": "start"
            },
            "wait_for_dashboard_to_be_ready": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "filter_record",
                "name": "wait_for_dashboard_to_be_ready"
            },
            "filter_record": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "filterRecord",
                    "process": "filter_for_record",
                    "parameters": {
                        "fetch_all_records_selector": "[for='dashboard-grid'] #prepared-fetch",
                        "filter_button_selector": "#pb-5 #rd-3 #search-button",
                        "filter_input_selector": "#pb-5 #rd-3 .responsive-dropdown-filter input",
                        "filter_value": "WOA1",
                        "internal_filter_btn_selector": ".dashboard pr-responsive-dropdown#rd-3 #filter"
                    }
                },
                "next_step": "click_record",
                "name": "filter_record"
            },
            "click_record": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": ".grid-row"
                },
                "next_step": "open_assist",
                "name": "click_record"
            },
            "open_assist": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "click_complete_all"
            },
            "click_complete_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-CompleteAllTasks"
                },
                "next_step": "close_assist"
            },
            "close_assist": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "button#assist"
                },
                "next_step": "wait_for_dialog"
            },
            "wait_for_dialog": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderCompleteAllTasksLogDashboard'][data-ready='true']"
                },
                "next_step": "select_record"
            },
            "select_record": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-template='WorkOrderCompleteAllTasksLogDashboard'] .grid-row"
                },
                "next_step": "click_view"
            },
            "click_view": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-View"
                },
                "next_step": "wait_for_view"
            },
            "wait_for_view": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderCompleteAllTasksLogUpdate'][data-ready='true']"
                },
                "next_step": "click_edit_tasks"
            },
            "click_edit_tasks": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-EditTask"
                },
                "next_step": "wait_for_edit"
            },
            "wait_for_edit": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='WorkOrderTaskUpdate'][data-ready='true']"
                }
            }
        }
    }
}