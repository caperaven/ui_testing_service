{
    "id": "User defined queries.",
    "sequences": [
        {
            "caption": "TC1: User Defined query with parameters",
            "process": "main"
        }
    ],
    "main": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "navigate",
                "args": {
                    "url": "https://onkeydev.pragmaproducts.com/contoso/daily/#dashboard/UserDefinedQuery",
                    "refresh": true
                },
                "next_step": "wait_for_dashboard_to_be_ready",
                "name": "start"
            },
            "wait_for_dashboard_to_be_ready": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "click_create",
                "name": "wait_for_dashboard_to_be_ready"
            },
            "click_create": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#create"
                },
                "next_step": "wait_for_dialog",
                "name": "click_create"
            },
            "wait_for_dialog": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='UserDefinedQueryCreate'][status='ready']"
                },
                "next_step": "fill_code",
                "name": "wait_for_dialog"
            },
            "fill_code": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-code",
                    "value": "TestCodeNew"
                },
                "next_step": "fill_description",
                "name": "fill_code"
            },
            "fill_description": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-description",
                    "value": "TestDescription"
                },
                "next_step": "fill_permission",
                "name": "fill_description"
            },
            "fill_permission": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-permissionTreeCode",
                    "value": "A10"
                },
                "next_step": "uncheck_permission",
                "name": "fill_permission"
            },
            "uncheck_permission": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#cb-addPermissionFilter"
                },
                "next_step": "click_query",
                "name": "uncheck_permission"
            },
            "click_query": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#pb-1_query"
                },
                "next_step": "fill_query",
                "name": "click_query"
            },
            "fill_query": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-query",
                    "value": "select * from wm.work_order where code like @code and type_of_work_id = @type_of_work"
                },
                "next_step": "click_parameters",
                "name": "fill_query"
            },
            "click_parameters": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#pb-2_parameter"
                },
                "next_step": "click_add_parameter",
                "name": "click_parameters"
            },
            "click_add_parameter": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#ibtn-addParameter"
                },
                "next_step": "wait_create_first",
                "name": "click_add_parameter"
            },
            "wait_create_first": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='UserDefinedQueryParameterCreateCustom'][status='ready']"
                },
                "next_step": "fill_first",
                "name": "wait_create_first"
            },
            "fill_first": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-parameterName",
                    "value": "@code"
                },
                "next_step": "click_accept",
                "name": "fill_first"
            },
            "click_accept": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#accept"
                },
                "next_step": "wait_for_dialog_after_first",
                "name": "click_accept"
            },
            "wait_for_dialog_after_first": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='UserDefinedQueryCreate'][status='ready']"
                },
                "next_step": "click_add_again",
                "name": "wait_for_dialog_after_first"
            },
            "click_add_again": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#ibtn-addParameter"
                },
                "next_step": "wait_create_second",
                "name": "click_add_again"
            },
            "wait_create_second": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='UserDefinedQueryParameterCreateCustom'][status='ready']"
                },
                "next_step": "fill_second",
                "name": "wait_create_second"
            },
            "fill_second": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "#lbl-parameterName",
                    "value": "@type_of_work"
                },
                "next_step": "click_accept_second",
                "name": "fill_second"
            },
            "click_accept_second": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#accept"
                },
                "next_step": "wait_for_dialog_after_second",
                "name": "click_accept_second"
            },
            "wait_for_dialog_after_second": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-template='UserDefinedQueryCreate'][status='ready']"
                },
                "next_step": "click_save",
                "name": "wait_for_dialog_after_second"
            },
            "click_save": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#primary"
                },
                "next_step": "wait_for_dashboard_again",
                "name": "click_save"
            },
            "wait_for_dashboard_again": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "filter_record",
                "name": "wait_for_dashboard_again"
            },
            "filter_record": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "filterRecord",
                    "process": "filter_for_record",
                    "parameters": {
                        "fetch_all_records_selector": "[for='dashboard-grid'] #prepared-fetch",
                        "filter_button_selector": "#search-button",
                        "filter_input_selector": "#pb-1 #rd-1 .responsive-dropdown-filter input",
                        "filter_value": "TestCodeNew",
                        "internal_filter_btn_selector": ".dashboard #filter"
                    }
                },
                "next_step": "select_row",
                "name": "filter_record"
            },
            "select_row": {
                "type": "perform",
                "action": "dbl_click",
                "args": {
                    "query": ".grid-row"
                },
                "next_step": "run",
                "name": "select_row"
            },
            "run": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btn-RunQuery"
                },
                "next_step": "wait_tab_to_open",
                "name": "run"
            },
            "wait_tab_to_open": {
                "type": "wait",
                "action": "window_count",
                "args": {
                    "count": 2
                },
                "next_step": "swap_to_new_tab",
                "name": "wait_tab_to_open"
            },
            "swap_to_new_tab": {
                "type": "perform",
                "action": "switch_to_tab",
                "args": {
                    "index": 1
                },
                "next_step": "wait_for_parameters",
                "name": "swap_to_new_tab"
            },
            "wait_for_parameters": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#user-defined-query-parameters"
                },
                "next_step": "fill_code_param",
                "name": "wait_for_parameters"
            },
            "fill_code_param": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "[data-id='@code']",
                    "value": "'R%'"
                },
                "next_step": "fill_type_param"
            },
            "fill_type_param": {
                "type": "perform",
                "action": "type_text",
                "args": {
                    "query": "[data-id='@type_of_work']",
                    "value": "2"
                },
                "next_step": "click_continue"
            },
            "click_continue": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#continueButton"
                },
                "next_step": "wait_results_grid"
            },
            "wait_results_grid": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "close_tab"
            },
            "close_tab": {
                "type": "perform",
                "action": "close_window",
                "args": {
                    "index": 1
                },
                "next_step": "wait_for_tab_to_close"
            },
            "wait_for_tab_to_close": {
                "type": "wait",
                "action": "window_count",
                "args": {
                    "count": 1
                },
                "next_step": "delete"
            },
            "delete": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#batch-delete"
                },
                "next_step": "accept_delete"
            },
            "accept_delete": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnMessage_true"
                }
            }
        }
    }
}