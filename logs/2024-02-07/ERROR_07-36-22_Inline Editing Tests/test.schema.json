{
    "id": "Inline Editing Tests",
    "sequences": [
        {
            "caption": "Clean Up Test Data",
            "process": "main"
        },
        {
            "caption": "TC1: Test Inline Editing lookup",
            "process": "lookup_test"
        }
    ],
    "main": {
        "steps": {
            "start": {
                "type": "perform",
                "action": "navigate",
                "args": {
                    "url": "https://onkeydev.pragmaproducts.com/contoso/daily/#dashboard/SiteType",
                    "refresh": true
                },
                "next_step": "wait_till_idle",
                "name": "start"
            },
            "wait_till_idle": {
                "type": "wait",
                "action": "idle",
                "args": {},
                "next_step": "wait_for_dashboard_grid_ready",
                "name": "wait_till_idle"
            },
            "wait_for_dashboard_grid_ready": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "filter"
            },
            "filter": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "filterRecord",
                    "process": "filter_for_record",
                    "parameters": {
                        "fetch_all_records_selector": "[for='dashboard-grid'] #prepared-fetch",
                        "filter_button_selector": "#pb-1 #rd-1 #search-button",
                        "filter_input_selector": "#pb-1 #rd-1 .responsive-dropdown-filter input",
                        "filter_value": "UITestRecord",
                        "internal_filter_btn_selector": ".dashboard pr-responsive-dropdown#rd-1 #filter"
                    }
                },
                "next_step": "select_all"
            },
            "select_all": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[name='select-all-checkbox']"
                },
                "next_step": "click_delete"
            },
            "click_delete": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#batch-delete"
                },
                "next_step": "click_yes"
            },
            "click_yes": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnMessage_true"
                },
                "next_step": "clear_search"
            },
            "clear_search": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#rd-1 #clearFilter"
                }
            }
        }
    },
    "lookup_test": {
        "steps": {
            "start": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "wait_for_dashboard_grid_ready",
                "name": "start"
            },
            "wait_for_dashboard_grid_ready": {
                "type": "wait",
                "action": "attribute",
                "args": {
                    "query": "#dashboard-grid",
                    "attr": "status",
                    "value": "ready"
                },
                "next_step": "click_query_builder"
            },
            "click_query_builder": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#queryBuilder"
                },
                "next_step": "wait_for_query_builder"
            },
            "wait_for_query_builder": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pragma-query-builder[status='ready']"
                },
                "next_step": "open_add_field"
            },
            "open_add_field": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnOpenResourceNavigator"
                },
                "next_step": "wait_for_resource_navigator"
            },
            "wait_for_resource_navigator": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "pragma-resource-navigator pragma-advanced-tree[status='ready']"
                },
                "next_step": "expand_permission_tree"
            },
            "expand_permission_tree": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-id='SiteType->PermissionTree'] #rightchevron"
                },
                "next_step": "wait_for_code"
            },
            "wait_for_code": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[data-id='SiteType->PermissionTree_Code']"
                },
                "next_step": "click_code"
            },
            "click_code": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[data-id='SiteType->PermissionTree_Code']"
                },
                "next_step": "click_accept"
            },
            "click_accept": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#accept"
                },
                "next_step": "click_run"
            },
            "click_run": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "pragma-action-button#save"
                },
                "next_step": "wait_for_grid_again"
            },
            "wait_for_grid_again": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#dashboard-grid[data-loaded='true'][status='ready']"
                },
                "next_step": "click_inline_editing"
            },
            "click_inline_editing": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#inline-editing"
                },
                "next_step": "wait_ready"
            },
            "wait_ready": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#dashboard-grid[data-loaded='true'][status='ready']"
                },
                "next_step": "click_add"
            },
            "click_add": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#insertEdit"
                },
                "next_step": "wait_for_new_row"
            },
            "wait_for_new_row": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "[icon='editingNew']"
                },
                "next_step": "code_description"
            },
            "code_description": {
                "type": "system",
                "action": "run_script",
                "args": {
                    "script": "inline_editing.js"
                },
                "next_step": "click_lookup_cell"
            },
            "click_lookup_cell": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": ".grid-row:last-child [role='cell']:nth-child(4)"
                },
                "next_step": "wait_for_lookup_button"
            },
            "wait_for_lookup_button": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#btnLookup"
                },
                "next_step": "click_lookup"
            },
            "click_lookup": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnLookup"
                },
                "next_step": "wait_for_lookup_grid"
            },
            "wait_for_lookup_grid": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#lookup[status='ready'][data-loaded='true']"
                },
                "next_step": "select_first_item"
            },
            "select_first_item": {
                "type": "perform",
                "action": "dbl_click",
                "args": {
                    "query": "#lookup .grid-row"
                },
                "next_step": "click_save"
            },
            "click_save": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#saveEdit"
                },
                "next_step": "wait_for_side_menu"
            },
            "wait_for_side_menu": {
                "type": "wait",
                "action": "element",
                "args": {
                    "query": "#panel4 #side-menu-close"
                },
                "next_step": "close_side_menu"
            },
            "close_side_menu": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#panel4 #side-menu-close"
                },
                "next_step": "exit_editing"
            },
            "exit_editing": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "[name='closeEditingButton']"
                },
                "next_step": "filter_record"
            },
            "filter_record": {
                "type": "system",
                "action": "template",
                "args": {
                    "schema": "filterRecord",
                    "process": "filter_for_record",
                    "parameters": {
                        "fetch_all_records_selector": "[for='dashboard-grid'] #prepared-fetch",
                        "filter_button_selector": "#pb-1 #rd-1 #search-button",
                        "filter_input_selector": "#pb-1 #rd-1 .responsive-dropdown-filter input",
                        "filter_value": "UITestRecord",
                        "internal_filter_btn_selector": ".dashboard pr-responsive-dropdown#rd-1 #filter"
                    }
                },
                "next_step": "click_record"
            },
            "click_record": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": ".grid-row"
                },
                "next_step": "click_delete"
            },
            "click_delete": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#batch-delete"
                },
                "next_step": "click_yes"
            },
            "click_yes": {
                "type": "perform",
                "action": "click",
                "args": {
                    "query": "#btnMessage_true"
                }
            }
        }
    }
}